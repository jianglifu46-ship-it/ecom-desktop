# 更新日志

## v1.1.0 (2026-01-30) - Bug修复版本

### 修复的问题

#### 1. 图片处理工具闪退问题 (Critical)
- **问题描述**: 点击"抠图"或"增强"按钮时应用程序闪退
- **修复方案**: 
  - 在 `tools/remove_bg.py` 中添加完善的异常捕获和错误处理
  - 在 `tools/enhance.py` 中添加错误处理，支持 RGBA 图片，失败时返回原图
  - 在 `ui/main_window.py` 中为抠图和增强功能添加 try-catch 块
  - 显示友好的错误提示对话框，而不是直接崩溃

#### 2. 图层被分屏遮挡问题
- **问题描述**: 导入的图片被分屏分隔线和标签遮挡，无法正常显示
- **修复方案**: 
  - 调整 `ui/canvas_editor.py` 中的绘制顺序
  - 先绘制图层内容，再绘制分屏标签和分隔线
  - 留白区域使用半透明填充（透明度100/255），不再完全遮挡图层

#### 3. 画布拖动卡顿问题
- **问题描述**: 拖动图片时画布响应缓慢，有明显卡顿
- **修复方案**: 
  - 在 `ui/canvas_editor.py` 中添加 QPixmap 缓存机制
  - 拖动图层时使用缓存的 pixmap，不再每帧重新渲染
  - 只有当图层属性（尺寸、旋转、透明度）或缩放比例变化时才重新生成缓存
  - 在 `core/layer.py` 中也添加了图层级别的渲染缓存

#### 4. 导入图片过大问题
- **问题描述**: 导入的图片尺寸过大，超出画布范围
- **修复方案**: 
  - 在 `core/layer.py` 中设置 `MAX_IMPORT_WIDTH = 600`（画布宽度750的80%）
  - 在 `core/layer.py` 中设置 `MAX_IMPORT_HEIGHT = 800`
  - 导入图片时自动按比例缩放到合适尺寸

### 技术改进

- 所有图片处理函数现在都有完善的错误处理
- 添加了 `get_error_message()` 函数用于获取详细错误信息
- 图层缓存机制大幅提升了画布渲染性能
- 代码中添加了更多注释说明

### 如何更新

```bash
# 从 GitHub 拉取最新代码
cd ecom-desktop
git pull origin main

# 重新安装依赖（如果需要）
pip install -r requirements.txt

# 运行应用
python main.py
```

### 已知限制

- **抠图功能**: 需要安装 `rembg` 库才能使用
  ```bash
  pip install rembg
  ```
- **图片增强**: 如果没有安装 OpenCV，会使用 Pillow 作为备用方案
  ```bash
  pip install opencv-python
  ```

---

## v1.0.0 (2026-01-29) - 初始版本

- 基础画布编辑功能
- 图层管理系统
- 分屏编辑
- 图片导入和处理
- Web 面板集成
- 登录认证
